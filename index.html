<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>如栈</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="如栈">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="如栈">
<meta property="og:locale">
<meta property="article:author" content="liujinliu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="如栈" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">如栈</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-shell常用命令记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/09/16/shell%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2019-09-16T00:00:00.000Z" itemprop="datePublished">2019-09-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/09/16/shell%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/">shell常用命令记录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="shell命令杀死进程和所有子进程"><a href="#shell命令杀死进程和所有子进程" class="headerlink" title="shell命令杀死进程和所有子进程"></a>shell命令杀死进程和所有子进程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstree pid -p| awk -F&quot;[()]&quot; &#x27;&#123;print $2&#125;&#x27;| xargs kill -9</span><br></pre></td></tr></table></figure>

<h4 id="shell获取上一条启动命令的进程号"><a href="#shell获取上一条启动命令的进程号" class="headerlink" title="shell获取上一条启动命令的进程号"></a>shell获取上一条启动命令的进程号</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nohup &#123;some command&#125; &amp;</span><br><span class="line">echo $!</span><br></pre></td></tr></table></figure>

<h4 id="shell获取当前运行脚本所在路径"><a href="#shell获取当前运行脚本所在路径" class="headerlink" title="shell获取当前运行脚本所在路径"></a>shell获取当前运行脚本所在路径</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cur_dir=$(cd &quot;$(dirname &quot;$0&quot;)&quot;; pwd)</span><br></pre></td></tr></table></figure>

<h4 id="windows换行符换成linux换行符"><a href="#windows换行符换成linux换行符" class="headerlink" title="windows换行符换成linux换行符"></a>windows换行符换成linux换行符</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dos2unix &#123;filename&#125;</span><br><span class="line">sed -i &#x27;s/\r//g&#x27; &#123;filename&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/09/16/shell%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/" data-id="ckpj5xeaf000l8inm97utbtqm" data-title="shell常用命令记录" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-mysql插入太多数据导致MySQL-server-has-gone-away" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/04/23/mysql%E6%8F%92%E5%85%A5%E5%A4%AA%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%AF%BC%E8%87%B4MySQL-server-has-gone-away/" class="article-date">
  <time class="dt-published" datetime="2018-04-23T00:00:00.000Z" itemprop="datePublished">2018-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/database/">database</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/04/23/mysql%E6%8F%92%E5%85%A5%E5%A4%AA%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%AF%BC%E8%87%B4MySQL-server-has-gone-away/">mysql插入太多数据导致MySQL-server-has-gone-away</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近在一次开发过程中，将数据写入mysql时候总是报</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MySQL server has gone away</span><br></pre></td></tr></table></figure>
<p>的错误，因为mysql就是本地启动的，而且从插入到报错整个过程时间很短，因此不可能是连接方面的timeout一类的问题。最后通过网上搜索，看到了遇到类似问题的<a target="_blank" rel="noopener" href="http://blog.csdn.net/fdipzone/article/details/51974165">帖子</a>，参考作者的做法，问题得到了解决。<br>
        
          <p class="article-more-link">
            <a href="/2018/04/23/mysql%E6%8F%92%E5%85%A5%E5%A4%AA%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%AF%BC%E8%87%B4MySQL-server-has-gone-away/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/04/23/mysql%E6%8F%92%E5%85%A5%E5%A4%AA%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%AF%BC%E8%87%B4MySQL-server-has-gone-away/" data-id="ckpj5xeaa000f8inmdvtxdvrh" data-title="mysql插入太多数据导致MySQL-server-has-gone-away" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ubuntu安装jdk7-jdk8的两种方式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/03/29/ubuntu%E5%AE%89%E8%A3%85jdk7-jdk8%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2018-03-29T00:00:00.000Z" itemprop="datePublished">2018-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/03/29/ubuntu%E5%AE%89%E8%A3%85jdk7-jdk8%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/">ubuntu安装jdk7-jdk8的两种方式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>原文地址：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/a2211009/p/4265225.html">http://www.cnblogs.com/a2211009/p/4265225.html</a>  </p>
<p>ubuntu安装jdk有两种方式</p>
<ul>
<li>通过ppa方式安装</li>
<li>通过官网下载源码安装</li>
</ul>
<p>这里记录采用ppa方式安装的方法</p>
<h3 id="1-添加ppa"><a href="#1-添加ppa" class="headerlink" title="1. 添加ppa"></a>1. 添加ppa</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:webupd8team/java</span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<h3 id="2-安装oracle-java-installer"><a href="#2-安装oracle-java-installer" class="headerlink" title="2. 安装oracle-java-installer"></a>2. 安装oracle-java-installer</h3><p>jdk7</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install oracle-java7-installer</span><br></pre></td></tr></table></figure>
<p>jdk8</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install oracle-java8-installer</span><br></pre></td></tr></table></figure>
<p>安装时候会询问是否同意oracle的服务条款，选择yes.<br>如果手懒不想自己动手点击，可以加入下面的命令，自动选择同意(这个是看到原文写了，本人没亲自试过)</p>
<h5 id="jdk7默认同意条款"><a href="#jdk7默认同意条款" class="headerlink" title="jdk7默认同意条款"></a>jdk7默认同意条款</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo oracle-java7-installer shared/accepted-oracle-license-v1-1 select true | sudo /usr/bin/debconf-set-selections</span><br></pre></td></tr></table></figure>
<h5 id="jdk8默认同意条款"><a href="#jdk8默认同意条款" class="headerlink" title="jdk8默认同意条款"></a>jdk8默认同意条款</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | sudo /usr/bin/debconf-set-selections</span><br></pre></td></tr></table></figure>

<h3 id="3-设置系统默认jdk"><a href="#3-设置系统默认jdk" class="headerlink" title="3. 设置系统默认jdk"></a>3. 设置系统默认jdk</h3><h5 id="jdk7"><a href="#jdk7" class="headerlink" title="jdk7"></a>jdk7</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-java-alternatives -s java-7-oracle</span><br></pre></td></tr></table></figure>
<h5 id="jdk8"><a href="#jdk8" class="headerlink" title="jdk8"></a>jdk8</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-java-alternatives -s java-8-oracle</span><br></pre></td></tr></table></figure>
<h3 id="4-测试jdk是否安装成功"><a href="#4-测试jdk是否安装成功" class="headerlink" title="4. 测试jdk是否安装成功"></a>4. 测试jdk是否安装成功</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br><span class="line">javac -version</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/03/29/ubuntu%E5%AE%89%E8%A3%85jdk7-jdk8%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/" data-id="ckpj5xeah000q8inma7m0aikc" data-title="ubuntu安装jdk7-jdk8的两种方式" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-DynamoDB启动本地版本和python-sdk使用示例" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/DynamoDB%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0%E7%89%88%E6%9C%AC%E5%92%8Cpython-sdk%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/database/">database</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/DynamoDB%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0%E7%89%88%E6%9C%AC%E5%92%8Cpython-sdk%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/">本地DynamoDB的启动方法</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>从<a target="_blank" rel="noopener" href="http://dynamodb-local.s3-website-us-west-2.amazonaws.com/dynamodb_local_2016-05-17.tar.gz%E4%B8%8B%E8%BD%BDDynamoDB%E7%9A%84%E6%8C%89%E7%85%A7%E5%8C%85%EF%BC%8C%E6%9C%AC%E5%9C%B0jre%E7%8E%AF%E5%A2%83%E7%9A%84%E9%85%8D%E7%BD%AE%E8%AF%B7%E8%87%AA%E8%A1%8C%E9%85%8D%E7%BD%AE">http://dynamodb-local.s3-website-us-west-2.amazonaws.com/dynamodb_local_2016-05-17.tar.gz下载DynamoDB的按照包，本地jre环境的配置请自行配置</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># tar zxf dynamodb_local_2016-05-17.tar.gz</span><br><span class="line"># mkdir data</span><br><span class="line"># java -Djava.library.path=./DynamoDBLocal_lib -jar DynamoDBLocal.jar -sharedDb -dbPath data</span><br><span class="line">Initializing DynamoDB Local with the following configuration:</span><br><span class="line">Port:	8000</span><br><span class="line">InMemory:	false</span><br><span class="line">DbPath:	data</span><br><span class="line">SharedDb:	true</span><br><span class="line">shouldDelayTransientStatuses:	false</span><br><span class="line">CorsParams:	*</span><br></pre></td></tr></table></figure>
<h3 id="Table-创建"><a href="#Table-创建" class="headerlink" title="Table 创建"></a>Table 创建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"></span><br><span class="line">import boto3</span><br><span class="line">from boto3.dynamodb.conditions import Key, Attr</span><br><span class="line"></span><br><span class="line">dynamodb = boto3.resource(&#x27;dynamodb&#x27;,</span><br><span class="line">                          endpoint_url=&#x27;http://localhost:8000&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def table_create():</span><br><span class="line">    table = dynamodb.create_table(</span><br><span class="line">        TableName=&#x27;users&#x27;,</span><br><span class="line">        KeySchema=[</span><br><span class="line">            &#123;</span><br><span class="line">                &#x27;AttributeName&#x27;: &#x27;username&#x27;,</span><br><span class="line">                &#x27;KeyType&#x27;: &#x27;HASH&#x27;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &#x27;AttributeName&#x27;: &#x27;last_name&#x27;,</span><br><span class="line">                &#x27;KeyType&#x27;: &#x27;RANGE&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        AttributeDefinitions=[</span><br><span class="line">            &#123;</span><br><span class="line">                &#x27;AttributeName&#x27;: &#x27;username&#x27;,</span><br><span class="line">                &#x27;AttributeType&#x27;: &#x27;S&#x27;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &#x27;AttributeName&#x27;: &#x27;last_name&#x27;,</span><br><span class="line">                &#x27;AttributeType&#x27;: &#x27;S&#x27;</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        ProvisionedThroughput=&#123;</span><br><span class="line">            &#x27;ReadCapacityUnits&#x27;: 5,</span><br><span class="line">            &#x27;WriteCapacityUnits&#x27;: 5</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    table.meta.client.get_waiter(&#x27;table_exists&#x27;).wait(TableName=&#x27;users&#x27;)</span><br></pre></td></tr></table></figure>
<h3 id="获取Table"><a href="#获取Table" class="headerlink" title="获取Table"></a>获取Table</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def table_get():</span><br><span class="line">    return dynamodb.Table(&#x27;users&#x27;)</span><br></pre></td></tr></table></figure>
<h3 id="写入item"><a href="#写入item" class="headerlink" title="写入item"></a>写入item</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def item_put():</span><br><span class="line">    table = table_get()</span><br><span class="line">    table.put_item(</span><br><span class="line">        Item=&#123;</span><br><span class="line">                &#x27;username&#x27;: &#x27;liujinliu&#x27;,</span><br><span class="line">                &#x27;first_name&#x27;: &#x27;Jinliu&#x27;,</span><br><span class="line">                &#x27;last_name&#x27;: &#x27;liu&#x27;,</span><br><span class="line">                &#x27;age&#x27;: 30,</span><br><span class="line">                &#x27;account_type&#x27;: &#x27;standard_user&#x27;,</span><br><span class="line">            &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<h3 id="获取item"><a href="#获取item" class="headerlink" title="获取item"></a>获取item</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def item_get():</span><br><span class="line">    table = table_get()</span><br><span class="line">    response = table.get_item(</span><br><span class="line">        Key=&#123;</span><br><span class="line">            &#x27;username&#x27;: &#x27;liujinliu&#x27;,</span><br><span class="line">            &#x27;last_name&#x27;: &#x27;liu&#x27;,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    item = response[&#x27;Item&#x27;]</span><br><span class="line">    return item</span><br></pre></td></tr></table></figure>
<h3 id="update-item"><a href="#update-item" class="headerlink" title="update item"></a>update item</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def item_update():</span><br><span class="line">    table = table_get()</span><br><span class="line">    table.update_item(</span><br><span class="line">        Key=&#123;</span><br><span class="line">            &#x27;username&#x27;: &#x27;liujinliu&#x27;,</span><br><span class="line">            &#x27;last_name&#x27;: &#x27;liu&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        UpdateExpression=&#x27;SET age = :val1&#x27;,</span><br><span class="line">        ExpressionAttributeValues=&#123;</span><br><span class="line">            &#x27;:val1&#x27;: 26</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<h3 id="删除item"><a href="#删除item" class="headerlink" title="删除item"></a>删除item</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def item_delete():</span><br><span class="line">    table = table_get()</span><br><span class="line">    table.delete_item(</span><br><span class="line">        Key=&#123;</span><br><span class="line">            &#x27;username&#x27;: &#x27;liujinliu&#x27;,</span><br><span class="line">            &#x27;last_name&#x27;: &#x27;liu&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<h3 id="获取表内item数量"><a href="#获取表内item数量" class="headerlink" title="获取表内item数量"></a>获取表内item数量</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def table_size():</span><br><span class="line">    table = table_get()</span><br><span class="line">    return table.item_count</span><br></pre></td></tr></table></figure>
<h3 id="批量更新-插入item"><a href="#批量更新-插入item" class="headerlink" title="批量更新/插入item"></a>批量更新/插入item</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">items = [</span><br><span class="line">    &#123;</span><br><span class="line">        &#x27;username&#x27;: &#x27;liujinliu&#x27;,</span><br><span class="line">        &#x27;last_name&#x27;: &#x27;liu&#x27;,</span><br><span class="line">        &#x27;first_name&#x27;: &#x27;jinliu&#x27;,</span><br><span class="line">        &#x27;age&#x27;: 25,</span><br><span class="line">        &#x27;address&#x27;: &#123;</span><br><span class="line">            &#x27;road&#x27;: &#x27;1 Jefferson Street&#x27;,</span><br><span class="line">            &#x27;city&#x27;: &#x27;LA&#x27;,</span><br><span class="line">            &#x27;state&#x27;: &#x27;CA&#x27;,</span><br><span class="line">            &#x27;zipcode&#x27;: &#x27;90001&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &#x27;username&#x27;: &#x27;wangyiyang&#x27;,</span><br><span class="line">        &#x27;last_name&#x27;: &#x27;wang&#x27;,</span><br><span class="line">        &#x27;first_name&#x27;: &#x27;yiyang&#x27;,</span><br><span class="line">        &#x27;age&#x27;: 26,</span><br><span class="line">        &#x27;address&#x27;: &#123;</span><br><span class="line">            &#x27;road&#x27;: &#x27;huilongguan&#x27;,</span><br><span class="line">            &#x27;city&#x27;: &#x27;Beijing&#x27;,</span><br><span class="line">            &#x27;state&#x27;: &#x27;CHINA&#x27;,</span><br><span class="line">            &#x27;zipcode&#x27;: &#x27;082&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &#x27;username&#x27;: &#x27;chenwenquan&#x27;,</span><br><span class="line">        &#x27;last_name&#x27;: &#x27;chen&#x27;,</span><br><span class="line">        &#x27;first_name&#x27;: &#x27;wenquan&#x27;,</span><br><span class="line">        &#x27;age&#x27;: 27,</span><br><span class="line">        &#x27;address&#x27;: &#123;</span><br><span class="line">            &#x27;road&#x27;: &#x27;jintailu&#x27;,</span><br><span class="line">            &#x27;city&#x27;: &#x27;henan&#x27;,</span><br><span class="line">            &#x27;state&#x27;: &#x27;JP&#x27;,</span><br><span class="line">            &#x27;zipcode&#x27;: &#x27;222&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &#x27;username&#x27;: &#x27;dengliangju&#x27;,</span><br><span class="line">        &#x27;last_name&#x27;: &#x27;deng&#x27;,</span><br><span class="line">        &#x27;first_name&#x27;: &#x27;liangju&#x27;,</span><br><span class="line">        &#x27;age&#x27;: 28,</span><br><span class="line">        &#x27;address&#x27;: &#123;</span><br><span class="line">            &#x27;road&#x27;: &#x27;qingnianlu&#x27;,</span><br><span class="line">            &#x27;city&#x27;: &#x27;chengdu&#x27;,</span><br><span class="line">            &#x27;state&#x27;: &#x27;India&#x27;,</span><br><span class="line">            &#x27;zipcode&#x27;: &#x27;333&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def batch_write():</span><br><span class="line">    table = table_get()</span><br><span class="line">    with table.batch_writer(overwrite_by_pkeys=[&#x27;username&#x27;,</span><br><span class="line">                                                &#x27;last_name&#x27;]) as batch:</span><br><span class="line">        for item in items:</span><br><span class="line">            batch.put_item(Item=item)</span><br></pre></td></tr></table></figure>
<h3 id="query-scan"><a href="#query-scan" class="headerlink" title="query, scan"></a>query, scan</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">def query():</span><br><span class="line">    table = table_get()</span><br><span class="line">    response = table.query(</span><br><span class="line">        KeyConditionExpression=Key(&#x27;username&#x27;).eq(&#x27;wangyiyang&#x27;)</span><br><span class="line">    )</span><br><span class="line">    items = response[&#x27;Items&#x27;]</span><br><span class="line">    return items</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def scan():</span><br><span class="line">    table = table_get()</span><br><span class="line">    response = table.scan(</span><br><span class="line">        FilterExpression=Attr(&#x27;age&#x27;).lt(28)</span><br><span class="line">    )</span><br><span class="line">    items = response[&#x27;Items&#x27;]</span><br><span class="line">    return items</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def scan_1():</span><br><span class="line">    table = table_get()</span><br><span class="line">    response = table.scan(</span><br><span class="line">        FilterExpression=Attr(&#x27;age&#x27;).lt(28) &amp; Attr(</span><br><span class="line">            &#x27;address.city&#x27;).begins_with(&#x27;B&#x27;)</span><br><span class="line">    )</span><br><span class="line">    items = response.get(&#x27;Items&#x27;, [])</span><br><span class="line">    return items</span><br></pre></td></tr></table></figure>
<h3 id="删除Table"><a href="#删除Table" class="headerlink" title="删除Table"></a>删除Table</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def table_delete():</span><br><span class="line">    table = table_get()</span><br><span class="line">    table.delete()</span><br></pre></td></tr></table></figure>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    table_create()</span><br><span class="line">    # item_put()</span><br><span class="line">    # print(item_get())</span><br><span class="line">    # item_update()</span><br><span class="line">    # print(item_get())</span><br><span class="line">    # print(table_size())</span><br><span class="line">    # item_delete()</span><br><span class="line">    print(table_size())</span><br><span class="line">    batch_write()</span><br><span class="line">    print(table_size())</span><br><span class="line">    # print(item_get())</span><br><span class="line">    print(query())</span><br><span class="line">    print(scan())</span><br><span class="line">    print(scan_1())</span><br><span class="line">    # table_delete()</span><br><span class="line">    # print(query())</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/DynamoDB%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0%E7%89%88%E6%9C%AC%E5%92%8Cpython-sdk%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/" data-id="ckpj5xe9w00018inm71wv8a8s" data-title="本地DynamoDB的启动方法" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-curl命令发送post表单提交" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/curl%E5%91%BD%E4%BB%A4%E5%8F%91%E9%80%81post%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/curl%E5%91%BD%E4%BB%A4%E5%8F%91%E9%80%81post%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4/">curl命令发送post表单提交</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近在用post测试一个web服务时候，发现发过去的post参数中的一个 ‘+’，在服务端接收后都变成了’ ‘(比如明明发送的是 ‘g+8’，接收到打印出来却是 ‘g 8’，命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s -d &quot;data=g+8&quot; http://127.0.0.1:8888/xxxx</span><br></pre></td></tr></table></figure>
<p>解决方法是先将 ‘g+8’ 进行urlencode，得到 ‘g%2b8’，然后在用curl去访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s -d &quot;data=g%2b8&quot; http://127.0.0.1:8888/xxxx</span><br></pre></td></tr></table></figure>
<p>-s 参数使得curl减少信息输出，不输出错误和进度信息</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/curl%E5%91%BD%E4%BB%A4%E5%8F%91%E9%80%81post%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4/" data-id="ckpj5xe9z00038inmep9v1n1w" data-title="curl命令发送post表单提交" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-elasticsearch中multi_match的一个小坑" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/elasticsearch%E4%B8%ADmulti_match%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%9D%91/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/elasticsearch%E4%B8%ADmulti_match%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%9D%91/">elasticsearch中multi_match的一个小坑</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近在使用elasticsearch的multi_match搜索时候，使用下面的body对一个字段下的所有字段进行递归搜索，但是当这些子字段出现数值类型的时候，就会报异常了，具体讨论可以参考<a target="_blank" rel="noopener" href="https://github.com/elastic/elasticsearch/issues/3975">这里</a><br>解决方法是加入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lenient</span><br></pre></td></tr></table></figure>
<p>参考下面的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;bool&quot;: &#123;</span><br><span class="line">            &quot;should&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;match&quot;: &#123;</span><br><span class="line">                        &quot;user_id&quot;: &#123;</span><br><span class="line">                            &quot;query&quot;: &quot;qwe&quot;,</span><br><span class="line">                            &quot;boost&quot;: 5</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;multi_match&quot;: &#123;</span><br><span class="line">                        &quot;query&quot;: &quot;qwer&quot;,</span><br><span class="line">                        &quot;lenient&quot;: &quot;true&quot;,  --ignore values that don&#x27;t fit specific fields</span><br><span class="line">                        &quot;fields&quot;: [</span><br><span class="line">                            &quot;device_brand&quot;,</span><br><span class="line">                            &quot;device_manufacturer&quot;,</span><br><span class="line">                            &quot;user_properties.*&quot; ---表明搜索此字段下的所有子字段</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;query_string&quot;: &#123;</span><br><span class="line">                        &quot;query&quot;: &quot;*qwe*&quot;,</span><br><span class="line">                        &quot;default_field&quot;: &quot;user_id&quot;,</span><br><span class="line">                        &quot;boost&quot;: 5</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;size&quot;: 10,</span><br><span class="line">    &quot;sort&quot;: [&quot;_score&quot;,&#123;&quot;session_id&quot;: &quot;asc&quot;&#125;]</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/elasticsearch%E4%B8%ADmulti_match%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%9D%91/" data-id="ckpj5xea000048inmeivd3vh1" data-title="elasticsearch中multi_match的一个小坑" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-elasticsearch调优" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/elasticsearch%E8%B0%83%E4%BC%98/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/elasticsearch%E8%B0%83%E4%BC%98/">elasticsearch调优</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>这部分是从同事的wiki上扒下来的，记在这里，作为以后使用的参考</p>
<h3 id="分片和副本调优"><a href="#分片和副本调优" class="headerlink" title="分片和副本调优"></a>分片和副本调优</h3><ol>
<li>更多分片使索引能传送到更多的服务器，意味着可以处理更多的文件，而不会降低性能  </li>
<li>更多分片意味着获取特定文档所需的资源量会减少，因为相较于部署更少分片时，存储在单个分片中的文件数量会更少  </li>
<li>更多分片意味着搜索索引时会面临更多问题，因为必须从更多分片中合并结果，使得查询的聚合阶段需要更多的资源</li>
<li>更多副本会增强集群系统的容错性，因为当原始分片不可用时，其副本将代替原始分片发挥作用，只拥有单个副本，集群可能在不丢失数据的情况下遗失分片。当拥有两个副本时，即时丢失了原始分片及其中一个副本，一切工作仍可以很好地继续下去。</li>
<li>更多副本意味着查询吞吐量会增加，因为执行车讯可以使用分片或分片的任一副本</li>
</ol>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>副本多：</p>
<ol>
<li>优点：查询速度快，容错性高</li>
<li>缺点：插入速度变慢</li>
</ol>
<p>分片多：</p>
<ol>
<li>优点：插入速度快</li>
<li>缺点：查询速度慢</li>
</ol>
<p>副本最好设置为2份提高容错性和查询速度，分片设置为节点数量的2倍提高插入速度，如果是大批量导入不做查询的话可取消副本</p>
<h3 id="Merge-吞吐量调优"><a href="#Merge-吞吐量调优" class="headerlink" title="Merge 吞吐量调优"></a>Merge 吞吐量调优</h3><p>系统默认是20mb，实际系统性能可能会更好，可适当调整 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl  -XPUT &quot;http://&lt;ip&gt;:9200/_cluster/settings&quot; -d</span><br><span class="line">&#x27;&#123;</span><br><span class="line">    &quot;persistent&quot;:</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;indices.store.throttle.type&quot;: &quot;merge&quot;,</span><br><span class="line">        &quot;indices.store.throttle.max_bytes_per_sec&quot;: &quot;200mb&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="刷新频率调优"><a href="#刷新频率调优" class="headerlink" title="刷新频率调优"></a>刷新频率调优</h3><p>大批量插入时，修改refresh_interval到-1（不刷新）或大于1s的时间，减少shard刷新间隔 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT &#x27;http://&lt;ip&gt;:9200/dw-search/_settings&#x27; -d &#x27;&#123; </span><br><span class="line">    &quot;index&quot; : &#123; </span><br><span class="line">        &quot;refresh_interval&quot; : &quot;-1&quot; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>插入完成后修改回默认值1s </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT &#x27;http://10.1.*.*:9200/dw-search/_settings&#x27; -d &#x27;&#123; </span><br><span class="line">    &quot;index&quot; : &#123; </span><br><span class="line">        &quot;refresh_interval&quot; : &quot;1s&quot; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;&#x27;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>另外下面的文章列出了很多有用的url<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/u014351782/article/details/51207650">http://blog.csdn.net/u014351782/article/details/51207650</a><br>其中关闭index这个方法在一次故障处理中起了很大的作用，我们发现系统一直报’too many open files’，然后找到elasticsearch进程，发现确实打开了很多句柄，然后调用 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9200/_nodes/process\?pretty</span><br></pre></td></tr></table></figure>

<p>发现最大句柄数已经是65530 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;max_file_descriptors&quot; : 65530,</span><br></pre></td></tr></table></figure>
<p>果然重启之后，句柄数很快还是飙到了65530，通过关闭index，句柄数得到了显著减少。</p>
<p>本篇博客还参考下面的博客：<br><a target="_blank" rel="noopener" href="http://www.wklken.me/posts/2015/05/23/elasticsearch-issues.html">http://www.wklken.me/posts/2015/05/23/elasticsearch-issues.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/elasticsearch%E8%B0%83%E4%BC%98/" data-id="ckpj5xea100058inm3qnma2xi" data-title="elasticsearch调优" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-jq工具的简单使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/jq%E5%B7%A5%E5%85%B7%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/jq%E5%B7%A5%E5%85%B7%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/">jq工具的简单使用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近因为工作需要，同事给我一个json文件，整个文件3M，全在一行，我去，简直崩溃。<br>使用<a target="_blank" rel="noopener" href="https://stedolan.github.io/jq/">jq</a>工具很好的解决了这个问题。</p>
<h3 id="1-安装jq"><a href="#1-安装jq" class="headerlink" title="1. 安装jq"></a>1. 安装jq</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install jq</span><br></pre></td></tr></table></figure>

<h3 id="2-在vim中的使用"><a href="#2-在vim中的使用" class="headerlink" title="2. 在vim中的使用"></a>2. 在vim中的使用</h3><p>最后一行模式下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%!jq &#x27;.&#x27;</span><br></pre></td></tr></table></figure>
<p>需要注意的是这样操作原文件就直接被改变了，所以最好提前备份下。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/jq%E5%B7%A5%E5%85%B7%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" data-id="ckpj5xea300078inmaioxhuht" data-title="jq工具的简单使用" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-linux磁盘配额限制方式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/linux%E7%A3%81%E7%9B%98%E9%85%8D%E9%A2%9D%E9%99%90%E5%88%B6%E6%96%B9%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/linux%E7%A3%81%E7%9B%98%E9%85%8D%E9%A2%9D%E9%99%90%E5%88%B6%E6%96%B9%E5%BC%8F/">linux磁盘配额限制方式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近研究docker的磁盘配额限制，貌似官方最新版本的docker已经支持，底层用的是linux的quota，于是自己对quota进行了简单的尝试，记录于此。本文将演示如何创建一个gquota的用户组，并对这个用户组下的用户进行磁盘配额限制。 </p>
<h4 id="查看内核是否支持"><a href="#查看内核是否支持" class="headerlink" title="查看内核是否支持"></a>查看内核是否支持</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># grep CONFIG_QUOTA /boot/config-[version]</span><br><span class="line">CONFIG_QUOTA=y</span><br><span class="line">CONFIG_QUOTA_NETLINK_INTERFACE=y</span><br><span class="line"># CONFIG_QUOTA_DEBUG is not set</span><br><span class="line">CONFIG_QUOTA_TREE=y</span><br><span class="line">CONFIG_QUOTACTL=y</span><br></pre></td></tr></table></figure>
<p>CONFIG_QUOTA和CONFIG_QUOTACTL两个y，恭喜，你的内核支持quota，否则就要升级或是重新编译内核了，貌似2.4以上的版本内核都支持</p>
<h4 id="修改内核fstab，对根目录开启磁盘配额限制"><a href="#修改内核fstab，对根目录开启磁盘配额限制" class="headerlink" title="修改内核fstab，对根目录开启磁盘配额限制"></a>修改内核fstab，对根目录开启磁盘配额限制</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/fstab</span><br></pre></td></tr></table></figure>
<p><img src="http://ljlimg.aimag.top/blog/images/20161027115636528" alt="这里写图片描述"><br>标出来的地方就是需要新增的地方，这个表示是对根目录进行磁盘配额限制，当然，也可以加在其他行，则是对其他的目录进行磁盘配额限制。</p>
<h4 id="查看目录挂载位置"><a href="#查看目录挂载位置" class="headerlink" title="查看目录挂载位置"></a>查看目录挂载位置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        16G   11G  4.4G  71% /</span><br><span class="line">tmpfs           938M   72K  938M   1% /dev/shm</span><br><span class="line">/dev/sda1       190M   32M  148M  18% /boot</span><br></pre></td></tr></table></figure>
<h4 id="重新挂载根目录分区，内核重新读取-etc-fstab文件"><a href="#重新挂载根目录分区，内核重新读取-etc-fstab文件" class="headerlink" title="重新挂载根目录分区，内核重新读取/etc/fstab文件"></a>重新挂载根目录分区，内核重新读取/etc/fstab文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># mount -o remount /</span><br><span class="line"># mount | grep quota</span><br><span class="line">/dev/sda3 on / type ext4 (rw,usrquota,grpquota)</span><br></pre></td></tr></table></figure>
<h4 id="通过quotacheck命令在根目录下生成quota配置文件"><a href="#通过quotacheck命令在根目录下生成quota配置文件" class="headerlink" title="通过quotacheck命令在根目录下生成quota配置文件"></a>通过quotacheck命令在根目录下生成quota配置文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># quotacheck -cugm /dev/sda3</span><br><span class="line"># ll / | grep quota</span><br><span class="line">-rw-------.   1 root root   8192 Oct 27 12:01 aquota.group</span><br><span class="line">-rw-------.   1 root root   7168 Oct 27 11:43 aquota.user</span><br></pre></td></tr></table></figure>
<h4 id="启动磁盘配额"><a href="#启动磁盘配额" class="headerlink" title="启动磁盘配额"></a>启动磁盘配额</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># quotaon /dev/sda3</span><br></pre></td></tr></table></figure>
<h4 id="创建一个用户组gquota，用来测试"><a href="#创建一个用户组gquota，用来测试" class="headerlink" title="创建一个用户组gquota，用来测试"></a>创建一个用户组gquota，用来测试</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># groupadd gquota</span><br></pre></td></tr></table></figure>
<h4 id="配置对用户组gquota的磁盘配额限制"><a href="#配置对用户组gquota的磁盘配额限制" class="headerlink" title="配置对用户组gquota的磁盘配额限制"></a>配置对用户组gquota的磁盘配额限制</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># edquota -g gquota</span><br></pre></td></tr></table></figure>
<p><img src="http://ljlimg.aimag.top/blog/images/20161027120951128" alt="这里写图片描述"><br>设置用户组gquota的软限制为480M，硬限制为500M（用户超过软限制会得到报警，超不过硬限制）</p>
<h4 id="新建用户并加入gquota用户组"><a href="#新建用户并加入gquota用户组" class="headerlink" title="新建用户并加入gquota用户组"></a>新建用户并加入gquota用户组</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># useradd -m temp</span><br><span class="line"># passwd temp</span><br><span class="line"># usermod -g gquota temp</span><br><span class="line"># su - temp</span><br></pre></td></tr></table></figure>
<h4 id="模拟大文件写入"><a href="#模拟大文件写入" class="headerlink" title="模拟大文件写入"></a>模拟大文件写入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># dd if=/dev/zero of=/home/temp/file1 bs=1M count=450</span><br></pre></td></tr></table></figure>
<p><img src="http://ljlimg.aimag.top/blog/images/20161027134117449" alt="这里写图片描述"><br>大小没有超过软限制，没有告警<br>再次写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># dd if=/dev/zero of=/home/temp/file3 bs=1M count=40</span><br></pre></td></tr></table></figure>
<p><img src="http://ljlimg.aimag.top/blog/images/20161027134601486" alt="这里写图片描述"><br>此时已经出现告警<br>再次写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># dd if=/dev/zero of=/home/temp/file3 bs=1M count=40</span><br></pre></td></tr></table></figure>
<p><img src="http://ljlimg.aimag.top/blog/images/20161027134956569" alt="这里写图片描述"><br>显示写入失败</p>
<h4 id="查看磁盘分配使用情况"><a href="#查看磁盘分配使用情况" class="headerlink" title="查看磁盘分配使用情况"></a>查看磁盘分配使用情况</h4><p><img src="http://ljlimg.aimag.top/blog/images/20161027135032847" alt="这里写图片描述"></p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>需要说明的一点是，对组的限制指的是这个组下面的所有用户加起来使用的磁盘总额，假设有个temp2用户也加入了gquota这个组，那么如果temp用户已经写入了400M，那么留给temp2用户的软限制则只剩80M，磁盘配额限制是可以针对单个用户的，即执行下面的命令，依然以新建一个temp用户为例，temp用户不用加入gquota组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos66-3 ~]# useradd -m temp</span><br><span class="line">[root@centos66-3 ~]# passwd temp</span><br><span class="line">[root@centos66-3 ~]# edquota -u temp</span><br></pre></td></tr></table></figure>
<p><img src="http://ljlimg.aimag.top/blog/images/20161027140343586" alt="这里写图片描述"><br>配置temp用户的磁盘配额软限制和硬限制依然可以采用上面的方式进行写入测试。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/linux%E7%A3%81%E7%9B%98%E9%85%8D%E9%A2%9D%E9%99%90%E5%88%B6%E6%96%B9%E5%BC%8F/" data-id="ckpj5xea500088inm1ete9ged" data-title="linux磁盘配额限制方式" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-mysql-python安装时EnvironmentError-mysql_config-not-found" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/mysql-python%E5%AE%89%E8%A3%85%E6%97%B6EnvironmentError-mysql_config-not-found/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/database/">database</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/mysql-python%E5%AE%89%E8%A3%85%E6%97%B6EnvironmentError-mysql_config-not-found/">mysql-python安装时EnvironmentError-mysql_config-not-found</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>转自：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/xiazh/archive/2012/12/12/2814289.html">http://www.cnblogs.com/xiazh/archive/2012/12/12/2814289.html</a><br>在安装 mysql-python时，会出现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sh: mysql_config: not found</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;setup.py&quot;, line 15, in &lt;module&gt;</span><br><span class="line">    metadata, options = get_config()</span><br><span class="line">  File &quot;/home/zhxia/apps/source/MySQL-python-1.2.3/setup_posix.py&quot;, line 43, in get_config</span><br><span class="line">    libs = mysql_config(&quot;libs_r&quot;)</span><br><span class="line">  File &quot;/home/zhxia/apps/source/MySQL-python-1.2.3/setup_posix.py&quot;, line 24, in mysql_config</span><br><span class="line">    raise EnvironmentError(&quot;%s not found&quot; % (mysql_config.path,))</span><br><span class="line">EnvironmentError: mysql_config not found</span><br></pre></td></tr></table></figure>

<p>解决方法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libmysqlclient-dev</span><br><span class="line">sudo updatedb</span><br><span class="line">locate mysql_config</span><br></pre></td></tr></table></figure>
<p>mysql_config的位置为：/usr/bin/mysql_config<br>通常情况下这就ok了，反正我的系统是ubuntu16.04这样做之后就好了。  </p>
<p>旧一点的系统据说还需要按下面的方式再处理下，仅供参考：<br>在mysql-python源码包下找到：setup_posix.py 文件，然后找到文件中的 mysql_config.path 将其值改为：/usr/bin/mysql_config,然后 sudo python setup.py install ,就ok</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/mysql-python%E5%AE%89%E8%A3%85%E6%97%B6EnvironmentError-mysql_config-not-found/" data-id="ckpj5xea7000b8inm34mhgjbq" data-title="mysql-python安装时EnvironmentError-mysql_config-not-found" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">weiter &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/09/16/shell%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/">shell常用命令记录</a>
          </li>
        
          <li>
            <a href="/2018/04/23/mysql%E6%8F%92%E5%85%A5%E5%A4%AA%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%AF%BC%E8%87%B4MySQL-server-has-gone-away/">mysql插入太多数据导致MySQL-server-has-gone-away</a>
          </li>
        
          <li>
            <a href="/2018/03/29/ubuntu%E5%AE%89%E8%A3%85jdk7-jdk8%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/">ubuntu安装jdk7-jdk8的两种方式</a>
          </li>
        
          <li>
            <a href="/2018/01/18/DynamoDB%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0%E7%89%88%E6%9C%AC%E5%92%8Cpython-sdk%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/">本地DynamoDB的启动方法</a>
          </li>
        
          <li>
            <a href="/2018/01/18/curl%E5%91%BD%E4%BB%A4%E5%8F%91%E9%80%81post%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4/">curl命令发送post表单提交</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 liujinliu<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>