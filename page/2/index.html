<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>如栈</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="如栈">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="如栈">
<meta property="og:locale">
<meta property="article:author" content="liujinliu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="如栈" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">如栈</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-mysql打开general_log" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/mysql%E6%89%93%E5%BC%80general_log/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/database/">database</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/mysql%E6%89%93%E5%BC%80general_log/">mysql打开general_log</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近在接收同时开发完的代码进行调试时候，一个事务执行过程没有报错，但是结果就是无法往数据库插入数据，最后打开general_log才发现是因为在代码执行过程，每次调用sdk接口进行sql执行时候都是重新连数据库，所以最后的commit相当于没有任何提交<br>方法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#&gt;: mysql  -uroot -p&#123;passwd&#125; -P3306</span><br><span class="line"># 查看当前general_log是否打开(OFF表明是关闭的)</span><br><span class="line">mysql&gt; show variables LIKE &#x27;%general%&#x27;;</span><br><span class="line">+------------------+-----------------------------------------------+</span><br><span class="line">| Variable_name    | Value                                         |</span><br><span class="line">+------------------+-----------------------------------------------+</span><br><span class="line">| general_log      | OFF                                           |</span><br><span class="line">| general_log_file | /srv/rds_cluster/mysql/xxxxxxxx.log |</span><br><span class="line">+------------------+-----------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 打开general_log</span><br><span class="line">mysql&gt; set global general_log=ON;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; quit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>
<p>可以执行一些语句然后再查看下general_log</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from user1;</span><br><span class="line">mysql&gt; quit</span><br><span class="line">Bye</span><br><span class="line"># 查看general_log</span><br><span class="line">-bash-4.1# cat /srv/rds_cluster/mysql/xxxxxxxx.log </span><br><span class="line">/opt/letv/mcluster/root/usr/libexec/mysqld, Version: 5.5.34-log (MySQL Galera Cluster (GPL), wsrep_23.7.6.rXXXX). started with:</span><br><span class="line">Tcp port: 3306  Unix socket: /var/lib/mysql/mysql.sock</span><br><span class="line">Time                 Id Command    Argument</span><br><span class="line">161117 11:12:04   944 Quit</span><br><span class="line">161117 11:12:11   945 Connect   root@localhost on </span><br><span class="line">                  945 Query     select @@version_comment limit 1</span><br><span class="line">161117 11:12:20   945 Query     SELECT DATABASE()</span><br><span class="line">                  945 Init DB   linzhanbo</span><br><span class="line">                  945 Query     show databases</span><br><span class="line">                  945 Query     show tables</span><br><span class="line">                  945 Field List        ___user1_old </span><br><span class="line">                  945 Field List        __user1_old </span><br><span class="line">                  945 Field List        _user1_old </span><br><span class="line">                  945 Field List        user1 </span><br><span class="line">                  945 Field List        userinfo </span><br><span class="line">161117 11:12:25   945 Query     show tables</span><br><span class="line">161117 11:12:33   945 Query     select * from user1</span><br><span class="line">161117 11:12:37   945 Quit</span><br></pre></td></tr></table></figure>
<p>下面就是我打开general_log之后定位问题发现的日志，可以看出来，每次执行sql都重新连接了mysql，这样事务最终没有执行成功也就比较好定位了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">161117 11:22:15   947 Connect   root@127.0.0.1 on xxxxxx</span><br><span class="line">                  947 Query     SET NAMES utf8</span><br><span class="line">                  947 Query     set autocommit=0</span><br><span class="line">                  947 Query     insert into user1(ID,age) values(0,23)</span><br><span class="line">                  948 Connect   root@127.0.0.1 on xxxxxx</span><br><span class="line">                  948 Query     SET NAMES utf8</span><br><span class="line">                  948 Query     set autocommit=0</span><br><span class="line">                  947 Quit</span><br><span class="line">                  949 Connect   root@127.0.0.1 on xxxxxx</span><br><span class="line">                  949 Query     SET NAMES utf8</span><br><span class="line">                  949 Query     set autocommit=0</span><br><span class="line">                  948 Quit</span><br><span class="line">                  949 Quit</span><br><span class="line">                  950 Connect   root@127.0.0.1 on xxxxxx</span><br><span class="line">                  950 Query     SET NAMES utf8</span><br><span class="line">                  950 Query     set autocommit=0</span><br><span class="line">                  950 Query     insert into user1(ID,age) values(1,24)</span><br><span class="line">                  951 Connect   root@127.0.0.1 on xxxxxx</span><br><span class="line">                  951 Query     SET NAMES utf8</span><br><span class="line">                  951 Query     set autocommit=0</span><br><span class="line">                  950 Quit</span><br><span class="line">                  952 Connect   root@127.0.0.1 on xxxxxx</span><br><span class="line">                  952 Query     SET NAMES utf8</span><br><span class="line">                  952 Query     set autocommit=0</span><br><span class="line">                  951 Quit</span><br><span class="line">                  952 Quit</span><br><span class="line">                  953 Connect   root@127.0.0.1 on xxxxxx</span><br><span class="line">                  953 Query     SET NAMES utf8</span><br><span class="line">                  953 Query     set autocommit=0</span><br><span class="line">                  953 Query     commit</span><br><span class="line">                  953 Quit</span><br></pre></td></tr></table></figure>
<p>另外需要说明一点的是create表和drop表的操作是不需要commit的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/mysql%E6%89%93%E5%BC%80general_log/" data-id="ckpj5jtx5000c8gnkaupa83gh" data-title="mysql打开general_log" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-nginx配置vhost的例子" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/nginx%E9%85%8D%E7%BD%AEvhost%E7%9A%84%E4%BE%8B%E5%AD%90/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/nginx%E9%85%8D%E7%BD%AEvhost%E7%9A%84%E4%BE%8B%E5%AD%90/">nginx配置vhost的例子</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>nginx下面几个配置vhost的例子<br>php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">server_name stage.localhost;</span><br><span class="line">listen 80 ;</span><br><span class="line">        root /data;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">location ~ .php$ &#123;</span><br><span class="line">        fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME  /data$fastcgi_script_name;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>静态文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">server_name sms.fake;</span><br><span class="line">listen 80 ;</span><br><span class="line">        root /data/fakesms;</span><br><span class="line">        index mobile1.html mobile1b.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他语言开发的server服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen   80;</span><br><span class="line">    server_name localhost.pythonserver;</span><br><span class="line"></span><br><span class="line">    access_log /var/log/nginx/pythonserver-access.log ;</span><br><span class="line">    error_log /var/log/nginx/pythonserver-error.log ;</span><br><span class="line">    charset utf-8;</span><br><span class="line">    client_max_body_size    100m;</span><br><span class="line">    client_body_timeout     60;      </span><br><span class="line">    location /exam0/ &#123;</span><br><span class="line">        proxy_pass http://127.0.0.1:8889;</span><br><span class="line">    &#125;</span><br><span class="line">    location /exam1/ &#123;</span><br><span class="line">        proxy_pass http://127.0.0.1:8880;</span><br><span class="line">    &#125;</span><br><span class="line">    location /exam2/ &#123;</span><br><span class="line">        proxy_pass http://127.0.0.1:8881;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>带upstream的写法例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">upstream rd_servers &#123;</span><br><span class="line">  server 127.0.0.1:5000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">  server_tokens off;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name redash.xxxxx.com;</span><br><span class="line">  access_log /var/log/nginx/rd.access.log;</span><br><span class="line"></span><br><span class="line">  gzip on;</span><br><span class="line">  gzip_types *;</span><br><span class="line">  gzip_proxied any;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_set_header Host $http_host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">    proxy_pass       http://rd_servers;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意的一点是，nginx默认的安装配置路径在/etc/nginx下面，在nginx.conf里面一般可以看到下面一行内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">include /etc/nginx/conf.d/*.conf;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>因此可以在conf.d下面灵活的增加自己的配置文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listen &#123;port&#125;</span><br></pre></td></tr></table></figure>
<p>这种配置是可以在多个配置文件出现的，但要注意的是同一个port，那么不同的配置文件一定要有不同的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server_name</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/nginx%E9%85%8D%E7%BD%AEvhost%E7%9A%84%E4%BE%8B%E5%AD%90/" data-id="ckpj5jtx8000g8gnk018a47ez" data-title="nginx配置vhost的例子" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-rabbitmq的简单管理命令笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/rabbitmq%E7%9A%84%E7%AE%80%E5%8D%95%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/rabbitmq%E7%9A%84%E7%AE%80%E5%8D%95%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4%E7%AC%94%E8%AE%B0/">rabbitmq的简单管理命令笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="rabbitmq最新版本在外部的访问权限上进行了进一步的控制，其中默认情况下，guest用户只能通过本地loopback端口访问"><a href="#rabbitmq最新版本在外部的访问权限上进行了进一步的控制，其中默认情况下，guest用户只能通过本地loopback端口访问" class="headerlink" title="rabbitmq最新版本在外部的访问权限上进行了进一步的控制，其中默认情况下，guest用户只能通过本地loopback端口访问"></a>rabbitmq最新版本在外部的访问权限上进行了进一步的控制，其中默认情况下，guest用户只能通过本地loopback端口访问</h4><p>为了在外部对rabbitmq进行连接和访问，需要新增用户，对用到的命令进行简单记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl add_user &lt;username&gt; &lt;userpass&gt;</span><br><span class="line">rabbitmqctl add_vhost &lt;path&gt;</span><br><span class="line">rabbitmqctl set_user_tags &lt;username&gt; administrator</span><br><span class="line">rabbitmqctl set_permissions -p &lt;path&gt; &lt;username&gt; &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br></pre></td></tr></table></figure>
<h4 id="rabbitmq简单状态查询命令"><a href="#rabbitmq简单状态查询命令" class="headerlink" title="rabbitmq简单状态查询命令"></a>rabbitmq简单状态查询命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl list_connections   ---用于查看当前的连接</span><br><span class="line">rabbitmqctl list_queues        ---会列出所有队列名称，后边可能还会带着这个队列当前消息数</span><br><span class="line">rabbitmqctl status             ---查看当前队列信息</span><br></pre></td></tr></table></figure>
<h4 id="rabbitmq恢复出厂设置命令"><a href="#rabbitmq恢复出厂设置命令" class="headerlink" title="rabbitmq恢复出厂设置命令"></a>rabbitmq恢复出厂设置命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl stop_app</span><br><span class="line">rabbitmqctl reset/force_reset</span><br><span class="line">rabbitmqctl start_app</span><br></pre></td></tr></table></figure>
<h4 id="rabbitmq清除队列里的消息"><a href="#rabbitmq清除队列里的消息" class="headerlink" title="rabbitmq清除队列里的消息"></a>rabbitmq清除队列里的消息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl -p $&#123;vhost-name&#125; purge_queue $&#123;queue-name&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/rabbitmq%E7%9A%84%E7%AE%80%E5%8D%95%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4%E7%AC%94%E8%AE%B0/" data-id="ckpj5jtx9000j8gnkd8xs8e2u" data-title="rabbitmq的简单管理命令笔记" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-一次inodes占用过多问题的解决" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/%E4%B8%80%E6%AC%A1inodes%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/%E4%B8%80%E6%AC%A1inodes%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3/">记一次inodes占用过多问题的解决</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近收到某台服务器告警，inodes使用过高，解决过程如下<br>首先在服务器上执行下面的命令查看哪个目录下inodes使用过高</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@vm]# df -i</span><br><span class="line">Filesystem              Inodes  IUsed     IFree IUse% Mounted on</span><br><span class="line">/dev/mapper/VGSYS-lv_root</span><br><span class="line">                        655360 101872    553488   16% /</span><br><span class="line">tmpfs                  2041469      1   2041468    1% /dev/shm</span><br><span class="line">/dev/vda1                51200     38     51162    1% /boot</span><br><span class="line">/dev/mapper/VGSYS-lv_var</span><br><span class="line">                        655360 569533     85827   87% /var</span><br><span class="line">/dev/mapper/VGSYS-lv_srv</span><br><span class="line">                     104644608   1727 104642881    1% /srv</span><br><span class="line">/dev/mapper/VGSYS-lv_vfs</span><br><span class="line">                      52428800      7  52428793    1% /srv/docker/vfs</span><br><span class="line">/dev/mapper/VGSYS-lv_log</span><br><span class="line">                      31457280    207  31457073    1% /var/log</span><br></pre></td></tr></table></figure>
<p>可以发现/var目录下inodes使用最大，使用下面的脚本进一步查找</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@vm]# for i in /var/*; do echo $i; find $i | wc -l; done</span><br><span class="line">/var/account</span><br><span class="line">2</span><br><span class="line">/var/cache</span><br><span class="line">98</span><br><span class="line">......</span><br><span class="line">/var/spool</span><br><span class="line">587003</span><br><span class="line">/var/tmp</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>通过这个方法，最终发现是”/var/spool/postfix/maildrop”目录下小文件过多。<br>通过上网搜索，原因如下： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">是由于linux在执行cron时，会将cron执行脚本中的output和warning信息，都会以邮件的形式发送Cron所有者，  </span><br><span class="line">而由于客户环境中的sendmail和postfix没有正常运行，导致邮件发送不成功，全部小文件堆积在了maildrop目录 </span><br><span class="line">下面，而且没有自动清理转换的机制，所以此目录堆积了大量的文件</span><br></pre></td></tr></table></figure>
<p>进入”/var/spool/postfix/maildrop”路径，使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls | xargs -n 10 rm -rf </span><br></pre></td></tr></table></figure>
<p>将文件清楚，问题得以恢复。</p>
<h3 id="根本解决方法"><a href="#根本解决方法" class="headerlink" title="根本解决方法"></a>根本解决方法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/crontab</span><br><span class="line">将MAILTO=root替换MAILTO=&quot;&quot;，然后service crond restart即可。如不行crontab -e 第一行增加MAILTO=&quot;&quot;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/%E4%B8%80%E6%AC%A1inodes%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3/" data-id="ckpj5jtxg000s8gnk6h4m0y8h" data-title="记一次inodes占用过多问题的解决" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-命令行制造cpu压力" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%88%B6%E9%80%A0cpu%E5%8E%8B%E5%8A%9B/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%88%B6%E9%80%A0cpu%E5%8E%8B%E5%8A%9B/">命令行制造cpu压力</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>原文：<a target="_blank" rel="noopener" href="http://liumissyou.blog.51cto.com/4828343/1430825/">http://liumissyou.blog.51cto.com/4828343/1430825/</a><br>一句话：</p>
<pre><code>cat /dev/urandom | md5sum
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%88%B6%E9%80%A0cpu%E5%8E%8B%E5%8A%9B/" data-id="ckpj5jtxh000u8gnkfu9ghm1s" data-title="命令行制造cpu压力" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-基于lxc的docker容器的disk-io监控方式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/%E5%9F%BA%E4%BA%8Elxc%E7%9A%84docker%E5%AE%B9%E5%99%A8%E7%9A%84disk-io%E7%9B%91%E6%8E%A7%E6%96%B9%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/%E5%9F%BA%E4%BA%8Elxc%E7%9A%84docker%E5%AE%B9%E5%99%A8%E7%9A%84disk-io%E7%9B%91%E6%8E%A7%E6%96%B9%E5%BC%8F/">基于lxc的docker容器的disk-io监控方式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>以一台测试机上的容器d-mcl-30_struc_test-n-2为例，容器id为373200daed7b，通过<code>docker inspec</code>t可以看到如下信息：<br><img src="https://i.loli.net/2021/06/05/DXRsuwyMSJnm6fP.png" alt="20161110190828780.png"></p>
<p>图中高亮出来的部分是我们从宿主机映射到容器内的一个路径，下面我们来看这个路径对应的设备<br><img src="https://img-blog.csdn.net/20161110190908546" alt="这里写图片描述"><br>通过下面的方法查看这个设备的真实路径(因为可能是一个软链接)<br><img src="https://img-blog.csdn.net/20161110191023781" alt="这里写图片描述"></p>
<p>通过下面的方法查找挂载设备的设备号：<br><img src="https://img-blog.csdn.net/20161110191111069" alt="这里写图片描述"></p>
<p>容器挂载路径disk设备的io可以通过监控下面的文件得到<br><img src="https://img-blog.csdn.net/20161110191208601" alt="这里写图片描述"></p>
<p>这个文件记录的是当前这个容器在这个设备的写入/读取字节数，通过对这个文件的监控，取两次监控数值的差，然后除以取样间隔时长得到disk-iops  </p>
<p>注意<br>如果通过nsenter命令进入一个容器采用dd命令进行磁盘读写测试，测试产生的读写是不会反应在这里说的文件上的。需要通过docker attach命令进入才可以</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/%E5%9F%BA%E4%BA%8Elxc%E7%9A%84docker%E5%AE%B9%E5%99%A8%E7%9A%84disk-io%E7%9B%91%E6%8E%A7%E6%96%B9%E5%BC%8F/" data-id="ckpj5jtxi000w8gnk27tk9y9z" data-title="基于lxc的docker容器的disk-io监控方式" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-记python中json反序列化的一次问题解决" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/%E8%AE%B0python%E4%B8%ADjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E4%B8%80%E6%AC%A1%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/%E8%AE%B0python%E4%B8%ADjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E4%B8%80%E6%AC%A1%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/">记python中json反序列化的一次问题解决</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最新在tornado接收body为json数据时，进行json的反序列化时候遇到一个问题，输入如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">body=&#x27;&#123;\n\t&quot;pts&quot;:[\n\t\t&#123;\n\t\t\t&quot;ddlSqls&quot;:&quot;create table user1(ID Varchar(20) NOT NULL, name Varchar(20))&quot;,\n\t\t\t&quot;type&quot;:&quot;CREATE&quot;\n\t\t&#125;,\n\t\t&#123;\n\t\t\t&quot;tbName&quot;:&quot;user1&quot;,\n\t\t\t&quot;ddlSqls&quot;:&quot;add column age int,drop column name&quot;,\n\t\t\t&quot;type&quot;:&quot;ALERT&quot;\n\t\t&#125;,\n\t\t]\n&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>这里直接调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json.loads(body, encoding=&#x27;utf-8&#x27;)</span><br></pre></td></tr></table></figure>
<p>会产生如下异常：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">HTTPRequest(protocol=&#x27;http&#x27;, host=&#x27;10.185.81.201:8888&#x27;, method=&#x27;POST&#x27;, uri=&#x27;/db/chenwenquan/ddl/batch&#x27;, version=&#x27;HTTP/1.1&#x27;, remote_ip=&#x27;10.75.139.125&#x27;, body=&#x27;&#123;\n\t&quot;pts&quot;:[\n\t\t&#123;\n\t\t\t&quot;ddlSqls&quot;:&quot;create table user1(ID Varchar(20) NOT NULL, name Varchar(20))&quot;,\n\t\t\t&quot;type&quot;:&quot;CREATE&quot;\n\t\t&#125;,\n\t\t&#123;\n\t\t\t&quot;tbName&quot;:&quot;user1&quot;,\n\t\t\t&quot;ddlSqls&quot;:&quot;add column age int,drop column name&quot;,\n\t\t\t&quot;type&quot;:&quot;ALERT&quot;\n\t\t&#125;,\n\t\t]\n&#125;&#x27;, headers=&#123;&#x27;Origin&#x27;: &#x27;chrome-extension://fhbjgbiflinjbdggehcddcbncdddomop&#x27;, &#x27;Content-Length&#x27;: &#x27;222&#x27;, &#x27;Accept-Language&#x27;: &#x27;zh-CN,zh;q=0.8&#x27;, &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate&#x27;, &#x27;Host&#x27;: &#x27;10.185.81.201:8888&#x27;, &#x27;Accept&#x27;: &#x27;*/*&#x27;, &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36&#x27;, &#x27;Connection&#x27;: &#x27;keep-alive&#x27;, &#x27;Cache-Control&#x27;: &#x27;no-cache&#x27;, &#x27;Content-Type&#x27;: &#x27;application/json&#x27;, &#x27;Postman-Token&#x27;: &#x27;65530e42-6a55-ad55-f91c-1ee81808cacc&#x27;&#125;)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/usr/lib/python2.6/site-packages/tornado/web.py&quot;, line 1073, in wrapper</span><br><span class="line">    return method(self, *args, **kwargs)</span><br><span class="line">  File &quot;/usr/lib/python2.6/site-packages/tornado/gen.py&quot;, line 104, in wrapper</span><br><span class="line">    gen = func(*args, **kwargs)</span><br><span class="line">  File &quot;/opt/letv/mcluster-manager/api/handlers/database.py&quot;, line 45, in post</span><br><span class="line">    body = json.loads(self.request.body, encoding=&#x27;utf-8&#x27;)</span><br><span class="line">  File &quot;/usr/lib64/python2.6/json/__init__.py&quot;, line 318, in loads</span><br><span class="line">    return cls(encoding=encoding, **kw).decode(s)</span><br><span class="line">  File &quot;/usr/lib64/python2.6/json/decoder.py&quot;, line 319, in decode</span><br><span class="line">    obj, end = self.raw_decode(s, idx=_w(s, 0).end())</span><br><span class="line">  File &quot;/usr/lib64/python2.6/json/decoder.py&quot;, line 336, in raw_decode</span><br><span class="line">    obj, end = self._scanner.iterscan(s, **kw).next()</span><br><span class="line">  File &quot;/usr/lib64/python2.6/json/scanner.py&quot;, line 55, in iterscan</span><br><span class="line">    rval, next_pos = action(m, context)</span><br><span class="line">  File &quot;/usr/lib64/python2.6/json/decoder.py&quot;, line 183, in JSONObject</span><br><span class="line">    value, end = iterscan(s, idx=end, context=context).next()</span><br><span class="line">  File &quot;/usr/lib64/python2.6/json/scanner.py&quot;, line 55, in iterscan</span><br><span class="line">    rval, next_pos = action(m, context)</span><br><span class="line">  File &quot;/usr/lib64/python2.6/json/decoder.py&quot;, line 219, in JSONArray</span><br><span class="line">    raise ValueError(errmsg(&quot;Expecting object&quot;, s, end))</span><br><span class="line">ValueError: Expecting object: line 12 column 3 (char 219)</span><br></pre></td></tr></table></figure>
<p>解决方式采用如下的方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json.loads(body, strict=False, encoding=&#x27;utf-8&#x27;)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/%E8%AE%B0python%E4%B8%ADjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E4%B8%80%E6%AC%A1%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" data-id="ckpj5jtxk000y8gnkavgu58q2" data-title="记python中json反序列化的一次问题解决" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-记一次docker部署web服务性能瓶颈解决过程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/%E8%AE%B0%E4%B8%80%E6%AC%A1docker%E9%83%A8%E7%BD%B2web%E6%9C%8D%E5%8A%A1%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88%E8%A7%A3%E5%86%B3%E8%BF%87%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/%E8%AE%B0%E4%B8%80%E6%AC%A1docker%E9%83%A8%E7%BD%B2web%E6%9C%8D%E5%8A%A1%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88%E8%A7%A3%E5%86%B3%E8%BF%87%E7%A8%8B/">记一次docker部署web服务性能瓶颈解决过程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在云计算领域，采用容器部署web服务越来越普遍，具有部署速度快，动态伸缩简单的特点。<br>最近参与了一次公司采用docker容器技术部署web服务的一次实践，在压测过程遇到了一个性能问题，记录下来作为以后开发的一个积累。</p>
<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><h4 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h4><p>单台物理机，24核，120G内存</p>
<h4 id="部署场景"><a href="#部署场景" class="headerlink" title="部署场景"></a>部署场景</h4><p>采用docker容器，容器内部跑web应用。</p>
<h4 id="压测过程"><a href="#压测过程" class="headerlink" title="压测过程"></a>压测过程</h4><p>并发500访问。<br>1.启动一个容器，进行压测<br>2.启动四个容器，进行压测 </p>
<h4 id="问题现象"><a href="#问题现象" class="headerlink" title="问题现象"></a>问题现象</h4><p>单容器场景下，没发现问题，跟物理部署单tomcat场景比，tps接近(均达到了17k)。<br>四个容器的场景下，发现tps只到23k，并且cpu占用只在50%左右。<br>后来我们把容器数量加到6个，发现依然没有改善，tps并没有上升。cpu占用率也没有提升。</p>
<h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><p>这个场景下很显然是有资源在cpu之前先到达了瓶颈。从而导致即使增加容器实例部署，也无法使cpu利用率上升。但通过对内存，network-io，disk-io监控，都没有发现有瓶颈出现，并且看了tomcat的线程数，即使全达到最大，也不会超出物理机的线程数限制。而在另外一个物理机上，这个tomcat的配置，4个实例是几乎可以将cpu打满。</p>
<h3 id="问题定位解决过程"><a href="#问题定位解决过程" class="headerlink" title="问题定位解决过程"></a>问题定位解决过程</h3><p>因为单容器时候没发现问题，因此我们重点怀疑是物理机的配置导致的。因此在我们这个启动容器的物理机上也部署了4个tomcat实例，压测发现果然跟4个容器一样，cpu无法打满，tps上不去。<br>这时候开发人员给了一个提示，怀疑是有cpu的软中断处理不过来了。<br>于是在又一次的压测过程，采用下面的命令进行监控</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mpstat -P ALL 1</span><br></pre></td></tr></table></figure>
<p>果然发现有个别cpu一直处于忙碌当中(idel列一直为0)<br>于是开发怀疑是物理的RPS没开，后来设置RPS之后就好了。</p>
<h3 id="关于RPS-RFS的一些理解"><a href="#关于RPS-RFS的一些理解" class="headerlink" title="关于RPS/RFS的一些理解"></a>关于RPS/RFS的一些理解</h3><p>参考<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/yy405145590/article/details/9837839">http://blog.csdn.net/yy405145590/article/details/9837839</a><br><a target="_blank" rel="noopener" href="http://www.linuxidc.com/Linux/2015-07/119424.htm">http://www.linuxidc.com/Linux/2015-07/119424.htm</a></p>
<ul>
<li>RPS全称是 Receive Packet Steering, 这是Google工程师 Tom Herbert (<a href="mailto:&#116;&#x68;&#x65;&#114;&#98;&#101;&#114;&#x74;&#64;&#x67;&#111;&#x6f;&#103;&#108;&#101;&#46;&#99;&#x6f;&#109;">&#116;&#x68;&#x65;&#114;&#98;&#101;&#114;&#x74;&#64;&#x67;&#111;&#x6f;&#103;&#108;&#101;&#46;&#99;&#x6f;&#109;</a> )提交的内核补丁, 在2.6.35进入Linux内核. 这个patch采用软件模拟的方式，实现了多队列网卡所提供的功能，分散了在多CPU系统上数据接收时的负载, 把软中断分到各个CPU处理，而不需要硬件支持，大大提高了网络性能。</li>
<li>RFS 全称是 Receive Flow Steering, 这也是Tom提交的内核补丁，它是用来配合RPS补丁使用的，是RPS补丁的扩展补丁，它把接收的数据包送达应用所在的CPU上，提高cache的命中率。</li>
<li>这两个补丁往往都是一起设置，来达到最好的优化效果, 主要是针对单队列网卡多CPU环境(多队列多重中断的网卡也可以使用该补丁的功能，但多队列多重中断网卡有更好的选择:SMP IRQ affinity)</li>
</ul>
<h4 id="简单原理"><a href="#简单原理" class="headerlink" title="简单原理"></a>简单原理</h4><p>RPS实现了数据流的hash归类，并把软中断的负载均衡分到各个cpu，实现了类似多队列网卡的功能。由于RPS只是单纯的把同一流的数据包分发给同一个CPU核来处理了，但是有可能出现这样的情况，即给该数据流分发的CPU核和执行处理该数据流的应用程序的CPU核不是同一个：数据包均衡到不同的cpu，这个时候如果应用程序所在的cpu和软中断处理的cpu不是同一个，此时对于cpu cache的影响会很大。那么RFS补丁就是用来确保应用程序处理的cpu跟软中断处理的cpu是同一个，这样就充分利用cpu的cache。</p>
<ul>
<li>应用RPS之前: 所有数据流被分到某个CPU, 多CPU没有被合理利用， 造成瓶颈</li>
<li>应用RPS之后: 同一流的数据包被分到同个CPU核来处理，但可能出现cpu cache迁跃</li>
<li>应用RPS+RFS之后: 同一流的数据包被分到应用所在的CPU核</li>
</ul>
<h4 id="必要条件"><a href="#必要条件" class="headerlink" title="必要条件"></a>必要条件</h4><p>使用RPS和RFS功能，需要有大于等于2.6.35版本的Linux kernel</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/%E8%AE%B0%E4%B8%80%E6%AC%A1docker%E9%83%A8%E7%BD%B2web%E6%9C%8D%E5%8A%A1%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88%E8%A7%A3%E5%86%B3%E8%BF%87%E7%A8%8B/" data-id="ckpj5jtxl00108gnkbri50xc5" data-title="记一次docker部署web服务性能瓶颈解决过程" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-通过nsenter进入docker容器的例子脚本" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/18/%E9%80%9A%E8%BF%87nsenter%E8%BF%9B%E5%85%A5docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BE%8B%E5%AD%90%E8%84%9A%E6%9C%AC/" class="article-date">
  <time class="dt-published" datetime="2018-01-18T00:00:00.000Z" itemprop="datePublished">2018-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/18/%E9%80%9A%E8%BF%87nsenter%E8%BF%9B%E5%85%A5docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BE%8B%E5%AD%90%E8%84%9A%E6%9C%AC/">通过nsenter进入docker容器的例子脚本</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>下面是一个通过nsenter进入docker容器的例子脚本：<br>文件名字：ns<br>使用方法：将文件放入系统PATH路径下，进入容器方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ns &lt;container-name/container-id&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">if [ -e $(dirname &quot;$0&quot;)/nsenter ]; then</span><br><span class="line">NSENTER=$(dirname &quot;$0&quot;)/nsenter</span><br><span class="line">else</span><br><span class="line">NSENTER=nsenter</span><br><span class="line">fi</span><br><span class="line">if [ -z &quot;$1&quot; ]; then</span><br><span class="line">echo &quot;Usage: `basename &quot;$0&quot;` CONTAINER [COMMAND [ARG]...]&quot;</span><br><span class="line">echo &quot;&quot;</span><br><span class="line">echo &quot;Enters the Docker CONTAINER and executes the specified COMMAND.&quot;</span><br><span class="line">echo &quot;If COMMAND is not specified, runs an interactive shell in CONTAINER.&quot;</span><br><span class="line">else</span><br><span class="line">PID=$(docker inspect -f &quot;&#123;&#123;.State.Pid&#125;&#125;&quot; &quot;$1&quot;)</span><br><span class="line">if [ -z &quot;$PID&quot; ]; then</span><br><span class="line">exit 1</span><br><span class="line">fi</span><br><span class="line">shift</span><br><span class="line">OPTS=&quot;--target $PID --mount --uts --ipc --net --pid --&quot;</span><br><span class="line">if [ -z &quot;$1&quot; ]; then</span><br><span class="line">&quot;$NSENTER&quot; $OPTS su - root</span><br><span class="line">else</span><br><span class="line">&quot;$NSENTER&quot; $OPTS env --ignore-environment -- &quot;$@&quot;</span><br><span class="line">fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/18/%E9%80%9A%E8%BF%87nsenter%E8%BF%9B%E5%85%A5docker%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BE%8B%E5%AD%90%E8%84%9A%E6%9C%AC/" data-id="ckpj5jtxm00128gnkc6macga7" data-title="通过nsenter进入docker容器的例子脚本" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-swap文件创建简单命令" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/06/28/swap%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E7%AE%80%E5%8D%95%E5%91%BD%E4%BB%A4/" class="article-date">
  <time class="dt-published" datetime="2017-06-28T00:00:00.000Z" itemprop="datePublished">2017-06-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/06/28/swap%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E7%AE%80%E5%8D%95%E5%91%BD%E4%BB%A4/">swap文件创建简单命令</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>创建一个10G的swap文件，放在home下面，给当前用户和root使用(由文件权限决定) </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd ~/</span><br><span class="line">dd if=/dev/zero of=swapfile bs=1G count=10</span><br><span class="line">chmod 600 swapfile</span><br><span class="line">mkswap swapfile</span><br><span class="line">sudo swapon swapfile</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/06/28/swap%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E7%AE%80%E5%8D%95%E5%91%BD%E4%BB%A4/" data-id="ckpj5jtxd000o8gnka568aj1x" data-title="swap文件创建简单命令" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; zurück</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">weiter &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/09/16/shell%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/">shell常用命令记录</a>
          </li>
        
          <li>
            <a href="/2018/04/23/mysql%E6%8F%92%E5%85%A5%E5%A4%AA%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%AF%BC%E8%87%B4MySQL-server-has-gone-away/">mysql插入太多数据导致MySQL-server-has-gone-away</a>
          </li>
        
          <li>
            <a href="/2018/03/29/ubuntu%E5%AE%89%E8%A3%85jdk7-jdk8%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/">ubuntu安装jdk7-jdk8的两种方式</a>
          </li>
        
          <li>
            <a href="/2018/01/18/DynamoDB%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0%E7%89%88%E6%9C%AC%E5%92%8Cpython-sdk%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/">本地DynamoDB的启动方法</a>
          </li>
        
          <li>
            <a href="/2018/01/18/curl%E5%91%BD%E4%BB%A4%E5%8F%91%E9%80%81post%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4/">curl命令发送post表单提交</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 liujinliu<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>